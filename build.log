riscv64-unknown-elf-as -g -march=rv64gc -mabi=lp64 -o entry.o entry.S
riscv64-unknown-elf-as -g -march=rv64gc -mabi=lp64 -o trap.o trap.S
riscv64-unknown-elf-as -g -march=rv64gc -mabi=lp64 -o userret.o userret.S
riscv64-unknown-elf-gcc -march=rv64gc -mabi=lp64 -nostdlib -c -g -ffreestanding -mcmodel=medany -o start.o start.c
riscv64-unknown-elf-gcc -march=rv64gc -mabi=lp64 -nostdlib -c -g -ffreestanding -mcmodel=medany -o fs.o fs.c
fs.c:78:9: warning: "R_Q_NUM" redefined
   78 | #define R_Q_NUM            0x038
      |         ^~~~~~~
fs.c:63:9: note: this is the location of the previous definition
   63 | #define R_Q_NUM            0x034
      |         ^~~~~~~
fs.c: In function 'virtio_blk_read':
fs.c:213:17: warning: passing argument 2 of 'memcpy' discards 'volatile' qualifier from pointer target type [-Wdiscarded-qualifiers]
  213 |     memcpy(dst, dma_buf, SECTOR_SIZE);
      |                 ^~~~~~~
fs.c:13:37: note: expected 'const void *' but argument is of type 'volatile uint8_t *' {aka 'volatile unsigned char *'}
   13 | void* memcpy(void *dst, const void *src, unsigned int n);
      |                         ~~~~~~~~~~~~^~~
riscv64-unknown-elf-gcc -march=rv64gc -mabi=lp64 -S -nostdlib -c -g -ffreestanding -mcmodel=medany -o fs.S fs.c
fs.c:78:9: warning: "R_Q_NUM" redefined
   78 | #define R_Q_NUM            0x038
      |         ^~~~~~~
fs.c:63:9: note: this is the location of the previous definition
   63 | #define R_Q_NUM            0x034
      |         ^~~~~~~
fs.c: In function 'virtio_blk_read':
fs.c:213:17: warning: passing argument 2 of 'memcpy' discards 'volatile' qualifier from pointer target type [-Wdiscarded-qualifiers]
  213 |     memcpy(dst, dma_buf, SECTOR_SIZE);
      |                 ^~~~~~~
fs.c:13:37: note: expected 'const void *' but argument is of type 'volatile uint8_t *' {aka 'volatile unsigned char *'}
   13 | void* memcpy(void *dst, const void *src, unsigned int n);
      |                         ~~~~~~~~~~~~^~~
riscv64-unknown-elf-gcc -march=rv64gc -mabi=lp64 -nostdlib -c -g -ffreestanding -mcmodel=medany -o trap_c.o trap.c
riscv64-unknown-elf-gcc -march=rv64gc -mabi=lp64 -nostdlib -c -g -ffreestanding -mcmodel=medany -o plic.o plic.c
riscv64-unknown-elf-gcc -O0 -nostdlib -static -o cat -g cat.c -mcmodel=medany -I. -fno-omit-frame-pointer 
/opt/homebrew/Cellar/riscv-gnu-toolchain/main/lib/gcc/riscv64-unknown-elf/14.2.0/../../../../riscv64-unknown-elf/bin/ld: warning: cannot find entry symbol _start; defaulting to 00000000000100e8
riscv64-unknown-elf-gcc -nostdlib -mcmodel=medany -static -nostartfiles -Wl,-e,main -o cat cat.c -I. -fno-omit-frame-pointer 
xxd -i cat > cat.h  
riscv64-unknown-elf-gcc -O0 -nostdlib -static -o hello -g hello.c -mcmodel=medany -I. -fno-omit-frame-pointer 
/opt/homebrew/Cellar/riscv-gnu-toolchain/main/lib/gcc/riscv64-unknown-elf/14.2.0/../../../../riscv64-unknown-elf/bin/ld: warning: cannot find entry symbol _start; defaulting to 00000000000100e8
riscv64-unknown-elf-gcc -nostdlib -mcmodel=medany -static -nostartfiles -Wl,-e,main -o hello hello.c -I. -fno-omit-frame-pointer 
xxd -i hello > hello.h  
riscv64-unknown-elf-gcc -O0 -nostdlib -static -o echo -g echo.c -mcmodel=medany -I. -fno-omit-frame-pointer 
echo.c:4:5: warning: conflicting types for built-in function 'strlen'; expected 'long unsigned int(const char *)' [-Wbuiltin-declaration-mismatch]
    4 | int strlen(const char *s) {
      |     ^~~~~~
echo.c:3:1: note: 'strlen' is declared in header '<string.h>'
    2 | #include <stdarg.h>
  +++ |+#include <string.h>
    3 | 
echo.c:12:6: warning: conflicting types for built-in function 'putchar'; expected 'int(int)' [-Wbuiltin-declaration-mismatch]
   12 | void putchar(char c)
      |      ^~~~~~~
echo.c:3:1: note: 'putchar' is declared in header '<stdio.h>'
    2 | #include <stdarg.h>
  +++ |+#include <stdio.h>
    3 | 
echo.c:17:6: warning: conflicting types for built-in function 'puts'; expected 'int(const char *)' [-Wbuiltin-declaration-mismatch]
   17 | void puts(const char *s) {
      |      ^~~~
echo.c:17:6: note: 'puts' is declared in header '<stdio.h>'
/opt/homebrew/Cellar/riscv-gnu-toolchain/main/lib/gcc/riscv64-unknown-elf/14.2.0/../../../../riscv64-unknown-elf/bin/ld: warning: cannot find entry symbol _start; defaulting to 00000000000100e8
riscv64-unknown-elf-gcc -nostdlib -mcmodel=medany -static -nostartfiles -Wl,-e,main -o echo echo.c -I. -fno-omit-frame-pointer 
echo.c:4:5: warning: conflicting types for built-in function 'strlen'; expected 'long unsigned int(const char *)' [-Wbuiltin-declaration-mismatch]
    4 | int strlen(const char *s) {
      |     ^~~~~~
echo.c:3:1: note: 'strlen' is declared in header '<string.h>'
    2 | #include <stdarg.h>
  +++ |+#include <string.h>
    3 | 
echo.c:12:6: warning: conflicting types for built-in function 'putchar'; expected 'int(int)' [-Wbuiltin-declaration-mismatch]
   12 | void putchar(char c)
      |      ^~~~~~~
echo.c:3:1: note: 'putchar' is declared in header '<stdio.h>'
    2 | #include <stdarg.h>
  +++ |+#include <stdio.h>
    3 | 
echo.c:17:6: warning: conflicting types for built-in function 'puts'; expected 'int(const char *)' [-Wbuiltin-declaration-mismatch]
   17 | void puts(const char *s) {
      |      ^~~~
echo.c:17:6: note: 'puts' is declared in header '<stdio.h>'
xxd -i echo > echo.h  
riscv64-unknown-elf-gcc -nostdlib -mcmodel=medany -static -nostartfiles -Wl,-e,main -o grep grep.c -I. -fno-omit-frame-pointer 
grep.c:4:5: warning: conflicting types for built-in function 'strlen'; expected 'long unsigned int(const char *)' [-Wbuiltin-declaration-mismatch]
    4 | int strlen(const char *s) {
      |     ^~~~~~
grep.c:3:1: note: 'strlen' is declared in header '<string.h>'
    2 | #include <stdarg.h>
  +++ |+#include <string.h>
    3 | 
grep.c:12:5: warning: conflicting types for built-in function 'memcmp'; expected 'int(const void *, const void *, long unsigned int)' [-Wbuiltin-declaration-mismatch]
   12 | int memcmp(const void *v1, const void *v2, unsigned int n) {
      |     ^~~~~~
grep.c:12:5: note: 'memcmp' is declared in header '<string.h>'
riscv64-unknown-elf-gcc -nostdlib -O0 -static -o hello3.elf -g hello3.c -mcmodel=medany -I. -fno-omit-frame-pointer 
/opt/homebrew/Cellar/riscv-gnu-toolchain/main/lib/gcc/riscv64-unknown-elf/14.2.0/../../../../riscv64-unknown-elf/bin/ld: warning: cannot find entry symbol _start; defaulting to 00000000000100e8
riscv64-unknown-elf-gcc -nostdlib -mcmodel=medany -static -nostartfiles -Wl,-e,main -o hello3.elf hello3.c -I. -fno-omit-frame-pointer 
riscv64-unknown-elf-gcc -nostdlib -O0 -static -o hello4.elf -g hello4.c -mcmodel=medany -I. -fno-omit-frame-pointer 
/opt/homebrew/Cellar/riscv-gnu-toolchain/main/lib/gcc/riscv64-unknown-elf/14.2.0/../../../../riscv64-unknown-elf/bin/ld: warning: cannot find entry symbol _start; defaulting to 00000000000100e8
riscv64-unknown-elf-gcc -nostdlib -mcmodel=medany -static -nostartfiles -Wl,-e,main -o hello4.elf hello4.c -I. -fno-omit-frame-pointer 
riscv64-unknown-elf-gcc -O0 -nostdlib -static -o ls -g ls.c -mcmodel=medany -I. -fno-omit-frame-pointer 
/opt/homebrew/Cellar/riscv-gnu-toolchain/main/lib/gcc/riscv64-unknown-elf/14.2.0/../../../../riscv64-unknown-elf/bin/ld: warning: cannot find entry symbol _start; defaulting to 00000000000100e8
riscv64-unknown-elf-gcc -nostdlib -mcmodel=medany -static -nostartfiles -Wl,-e,main -o ls ls.c -I. -fno-omit-frame-pointer 
riscv64-unknown-elf-gcc -O0 -nostdlib -static -o pwd -g pwd.c -mcmodel=medany -I. -fno-omit-frame-pointer 
/opt/homebrew/Cellar/riscv-gnu-toolchain/main/lib/gcc/riscv64-unknown-elf/14.2.0/../../../../riscv64-unknown-elf/bin/ld: warning: cannot find entry symbol _start; defaulting to 00000000000100e8
riscv64-unknown-elf-gcc -nostdlib -mcmodel=medany -static -nostartfiles -Wl,-e,main -o pwd pwd.c -I. -fno-omit-frame-pointer 
# build login user program (required by mkfs)
riscv64-unknown-elf-gcc -O0 -nostdlib -static -o login -g login.c -mcmodel=medany -I. -fno-omit-frame-pointer 
/opt/homebrew/Cellar/riscv-gnu-toolchain/main/lib/gcc/riscv64-unknown-elf/14.2.0/../../../../riscv64-unknown-elf/bin/ld: warning: cannot find entry symbol _start; defaulting to 00000000000100e8
riscv64-unknown-elf-gcc -nostdlib -mcmodel=medany -static -nostartfiles -Wl,-e,main -o login login.c -I. -fno-omit-frame-pointer 
riscv64-unknown-elf-gcc -I. -nostdlib -S -O0 -static -o sh.S -g sh.c -mcmodel=medany -I. -fno-omit-frame-pointer 
sh.c:8:7: warning: conflicting types for built-in function 'strncpy'; expected 'char *(char *, const char *, long unsigned int)' [-Wbuiltin-declaration-mismatch]
    8 | char* strncpy(char *s, const char *t, int n) {
      |       ^~~~~~~
sh.c:5:1: note: 'strncpy' is declared in header '<string.h>'
    4 | #include "fs.h"
  +++ |+#include <string.h>
    5 | #include <stdint.h>
sh.c:19:6: warning: conflicting types for built-in function 'putchar'; expected 'int(int)' [-Wbuiltin-declaration-mismatch]
   19 | void putchar(char c)
      |      ^~~~~~~
sh.c:5:1: note: 'putchar' is declared in header '<stdio.h>'
    4 | #include "fs.h"
  +++ |+#include <stdio.h>
    5 | #include <stdint.h>
sh.c:217:6: warning: conflicting types for built-in function 'puts'; expected 'int(const char *)' [-Wbuiltin-declaration-mismatch]
  217 | void puts(const char *s) {
      |      ^~~~
sh.c:217:6: note: 'puts' is declared in header '<stdio.h>'
riscv64-unknown-elf-gcc -I. -nostdlib -O0 -static -o sh.elf -I. -g sh.c -mcmodel=medany -I. -fno-omit-frame-pointer 
sh.c:8:7: warning: conflicting types for built-in function 'strncpy'; expected 'char *(char *, const char *, long unsigned int)' [-Wbuiltin-declaration-mismatch]
    8 | char* strncpy(char *s, const char *t, int n) {
      |       ^~~~~~~
sh.c:5:1: note: 'strncpy' is declared in header '<string.h>'
    4 | #include "fs.h"
  +++ |+#include <string.h>
    5 | #include <stdint.h>
sh.c:19:6: warning: conflicting types for built-in function 'putchar'; expected 'int(int)' [-Wbuiltin-declaration-mismatch]
   19 | void putchar(char c)
      |      ^~~~~~~
sh.c:5:1: note: 'putchar' is declared in header '<stdio.h>'
    4 | #include "fs.h"
  +++ |+#include <stdio.h>
    5 | #include <stdint.h>
sh.c:217:6: warning: conflicting types for built-in function 'puts'; expected 'int(const char *)' [-Wbuiltin-declaration-mismatch]
  217 | void puts(const char *s) {
      |      ^~~~
sh.c:217:6: note: 'puts' is declared in header '<stdio.h>'
/opt/homebrew/Cellar/riscv-gnu-toolchain/main/lib/gcc/riscv64-unknown-elf/14.2.0/../../../../riscv64-unknown-elf/bin/ld: warning: cannot find entry symbol _start; defaulting to 00000000000100e8
riscv64-unknown-elf-gcc -nostdlib -mcmodel=medany -static -nostartfiles -Wl,-e,main -o sh.elf sh.c -I. -fno-omit-frame-pointer 
sh.c:8:7: warning: conflicting types for built-in function 'strncpy'; expected 'char *(char *, const char *, long unsigned int)' [-Wbuiltin-declaration-mismatch]
    8 | char* strncpy(char *s, const char *t, int n) {
      |       ^~~~~~~
sh.c:5:1: note: 'strncpy' is declared in header '<string.h>'
    4 | #include "fs.h"
  +++ |+#include <string.h>
    5 | #include <stdint.h>
sh.c:19:6: warning: conflicting types for built-in function 'putchar'; expected 'int(int)' [-Wbuiltin-declaration-mismatch]
   19 | void putchar(char c)
      |      ^~~~~~~
sh.c:5:1: note: 'putchar' is declared in header '<stdio.h>'
    4 | #include "fs.h"
  +++ |+#include <stdio.h>
    5 | #include <stdint.h>
sh.c:217:6: warning: conflicting types for built-in function 'puts'; expected 'int(const char *)' [-Wbuiltin-declaration-mismatch]
  217 | void puts(const char *s) {
      |      ^~~~
sh.c:217:6: note: 'puts' is declared in header '<stdio.h>'
xxd -i sh.elf > sh.h  
dd if=/dev/zero of=fs.img bs=1k count=512
512+0 records in
512+0 records out
524288 bytes transferred in 0.001644 secs (318909976 bytes/sec)
dd if=hello of=fs.img bs=512 seek=0 conv=notrunc
3+1 records in
3+1 records out
1768 bytes transferred in 0.000022 secs (80363636 bytes/sec)
dd if=cat of=fs.img bs=512 seek=0 conv=notrunc
3+1 records in
3+1 records out
1608 bytes transferred in 0.000023 secs (69913043 bytes/sec)
dd if=echo of=fs.img bs=512 seek=0 conv=notrunc
3+1 records in
3+1 records out
1824 bytes transferred in 0.000023 secs (79304348 bytes/sec)
dd if=grep of=fs.img bs=512 seek=128 conv=notrunc
4+1 records in
4+1 records out
2088 bytes transferred in 0.000023 secs (90782609 bytes/sec)
gcc -o mkfs mkfs.c
mkfs.c:384:76: warning: format specifies type 'int' but the argument has type 'unsigned long' [-Wformat]
  384 |         fprintf(stderr, "b.txt が大きすぎます (上限 %d bytes)\n", MAXFILESIZE);
      |                                                     ~~            ^~~~~~~~~~~
      |                                                     %lu
mkfs.c:36:21: note: expanded from macro 'MAXFILESIZE'
   36 | #define MAXFILESIZE (MAXFILE * BSIZE)
      |                     ^~~~~~~~~~~~~~~~~
1 warning generated.
./mkfs fs.img
[mkfs] embed 'cat' -> inum 3
[mkfs] embed 'grep' -> inum 4
[mkfs] embed 'hello3.elf' -> inum 5
[mkfs] embed 'hello4.elf' -> inum 6
[mkfs] embed 'a.txt' -> inum 7
[mkfs] embed 'b.txt' -> inum 8
[mkfs] embed 'c.txt' -> inum 9
[mkfs] embed 'd.txt' -> inum 10
[mkfs] embed 'echo' -> inum 11
[mkfs] embed 'hello' -> inum 12
[mkfs] embed 'ls' -> inum 13
[mkfs] embed 'pwd' -> inum 14
[mkfs] embed 'passwd' -> inum 15
[mkfs] embed 'group' -> inum 16
[mkfs] embed 'login' -> inum 17
[mkfs] embed 'sh.elf' -> inum 18
mkfs 完了: 出力ファイル 'fs.img' (サイズ 131072 bytes)
riscv64-unknown-elf-gcc -march=rv64gc -mabi=lp64 -nostdlib -c -O0 -g -ffreestanding -mcmodel=medany -std=gnu11 -o main.o main.c
main.c:62:9: warning: "NULL" redefined
   62 | #define NULL ((void*)0)
      |         ^~~~
In file included from main.c:4:
/opt/homebrew/Cellar/riscv-gnu-toolchain/main/lib/gcc/riscv64-unknown-elf/14.2.0/include/stddef.h:404:9: note: this is the location of the previous definition
  404 | #define NULL ((void *)0)
      |         ^~~~
main.c: In function 'strdup':
main.c:167:16: warning: initialization discards 'const' qualifier from pointer target type [-Wdiscarded-qualifiers]
  167 |     char* s2 = s;
      |                ^
main.c: At top level:
main.c:1373:9: warning: "UART_THR" redefined
 1373 | #define UART_THR      ((volatile uint8_t *)(UART0 + 0x00))  // 書き込み用
      |         ^~~~~~~~
main.c:76:9: note: this is the location of the previous definition
   76 | #define UART_THR     (*(volatile uint8_t*)(UART0 + 0x00))  // Transmit Holding Register
      |         ^~~~~~~~
main.c:1374:9: warning: "UART_LSR" redefined
 1374 | #define UART_LSR      ((volatile uint8_t *)(UART0 + 0x05))  // Line Status Register
      |         ^~~~~~~~
main.c:77:9: note: this is the location of the previous definition
   77 | #define UART_LSR     (*(volatile uint8_t*)(UART0 + 0x05))  // Line Status Register
      |         ^~~~~~~~
main.c:1379:9: warning: "SSTATUS_SIE" redefined
 1379 | #define SSTATUS_SIE (1UL << 1) // Sstatus.SIE
      |         ^~~~~~~~~~~
main.c:1024:9: note: this is the location of the previous definition
 1024 | #define SSTATUS_SIE (1L << 1)  // Supervisor Interrupt Enable
      |         ^~~~~~~~~~~
riscv64-unknown-elf-gcc -march=rv64gc -mabi=lp64 -nostdlib -g -O0 -T link.ld -Wl,-Map=map.txt -mcmodel=medany -o kernel.elf entry.o start.o userret.o trap.o fs.o plic.o trap_c.o main.o 
riscv64-unknown-elf-objcopy -O binary kernel.elf kernel.bin
